# /bin/bash

# Make sure we're in workdir
cd $(dirname "$BASH_SOURCE")

# This will ensure if any of sub-shells fail,
# this shell will fail too (thus not continue).
set -e

# Determine extra args/flags
BRANCH="$(git rev-parse --abbrev-ref HEAD)"
EXTRA_ARGS=""

if [[ "$BRANCH" == "master" ]]; then
	if  [[ ! -z "$BUILD_NUMBER" ]]; then
		EXTRA_ARGS="$EXTRA_ARGS -Drevision=.$BUILD_NUMBER"
	fi
fi

echo $EXTRA_ARGS

# Build
echo "Building..."
mvn clean compile assembly:single $EXTRA_ARGS

# Output
JARFILE=$(ls ./target/*.jar)
echo "The built executable can be found at $JARFILE"
